<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Forgot Password - Modern Store</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="StyleSheet.css" rel="stylesheet">
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">OS</div>
      <h1>Modern Store</h1>
    </div>
  </header>

  <main class="container mt-4">
    <h2>Forgot Password</h2>
    <form id="forgetForm">
      <label>Username</label>
      <input type="text" id="forgetUsername" class="form-control mb-2" required>
      <label>Email</label>
      <input type="email" id="forgetEmail" class="form-control mb-2" required>
      <button type="submit" class="btn btn-primary mt-2">Send Code</button>
    </form>

    <div id="codeSection" style="display:none;">
      <label>Enter Code</label>
      <input type="text" id="codeInput" class="form-control mb-2">
      <button id="verifyCodeBtn" class="btn btn-success me-2">Submit Code</button>
      <button id="resendBtn" class="btn btn-secondary">Resend Code</button>
    </div>
  </main>

  <!-- ‚úÖ EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    (function() {
      emailjs.init("cHE_aPzeIandEzH84"); // Your EmailJS public key
    })();

    let verificationCode = "";

    function sendResetCode(email) {
      verificationCode = Math.floor(100000 + Math.random() * 900000); // 6-digit code

      emailjs.send("service_6hf1npt", "template_8n8df7s", {
        email: email, // üëà match this with your EmailJS variable name
        code: verificationCode
      })
      .then(() => {
        alert("‚úÖ Code sent successfully to " + email);
      })
      .catch((error) => {
        console.error("EmailJS Error:", error);
        alert("‚ùå Failed to send email. Please check console for details.");
      });
    }

    const forgetForm = document.getElementById("forgetForm");
    const codeSection = document.getElementById("codeSection");

    forgetForm.addEventListener("submit", function(e) {
      e.preventDefault();
      sendResetCode(document.getElementById("forgetEmail").value);
      forgetForm.style.display = "none";
      codeSection.style.display = "block";
    });

    document.getElementById("resendBtn").onclick = function() {
      sendResetCode(document.getElementById("forgetEmail").value);
    };

    document.getElementById("verifyCodeBtn").onclick = function() {
      if (document.getElementById("codeInput").value == verificationCode) {
        window.location.href = "change-password.html";
      } else {
        alert("‚ùå Invalid code. Please try again.");
      }
    };
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
